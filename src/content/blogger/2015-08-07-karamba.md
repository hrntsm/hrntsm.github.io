---
path: "/blog/2015/08/karamba"
title: "karambaのデータツリー考察"
date: "15/08/07"
originalUrl: "https://rgkr-memo.blogspot.com/2015/08/karamba.html"
slug: "/blog/2015/08/karamba"
tags:
    - karamba
    - grasshopper
---
<div dir="ltr">　Grasshopperにおいて、データツリーが非常に重要な要素です。ここではKarambaにおけるデータツリー扱いに関して検証します。</div><div dir="ltr">　単純な2本のカーブについて考えてみます。はじめにRhino上で2本のカーブを書きます。図示するために点をうっていますが特に意味はありません。</div><div class="separator" style="clear: both; text-align: center;"></div><div dir="ltr">　Curveコンポーネントに2本のカーブを取り込むと、その中身はPanelコンポーネントに示されるよううに、｛ 0 ｝の中に2つのカーブが入っています。</div><div dir="ltr">  
</div><div class="separator" style="clear: both; text-align: center;">[![](http://3.bp.blogspot.com/-4mqp9WvjknQ/VcNpA5AQqOI/AAAAAAAAAEo/s9F81rcKGJc/s400/%25E3%2582%25AB%25E3%2583%25BC%25E3%2583%2596%25E3%2581%25AE%25E5%258F%2596%25E3%2582%258A%25E8%25BE%25BC%25E3%2581%25BF.JPG)](http://3.bp.blogspot.com/-4mqp9WvjknQ/VcNpA5AQqOI/AAAAAAAAAEo/s9F81rcKGJc/s1600/%25E3%2582%25AB%25E3%2583%25BC%25E3%2583%2596%25E3%2581%25AE%25E5%258F%2596%25E3%2582%258A%25E8%25BE%25BC%25E3%2581%25BF.JPG)</div><div dir="ltr">  
</div><div dir="ltr">このカーブをKarambaのLine to Beamコンポーネントを使用してkrambaに取り込み、Model View コンポーネントを使用して、ノードとエレメントのタグを確認すると、下図のように重複なくふられていることが分かります。つまりは、一つのモデルとして認識されていることが分かります。</div><div dir="ltr">  
</div><div class="separator" style="clear: both; text-align: center;">[![](http://1.bp.blogspot.com/-p1C9a2Do93U/VcNqS-T3MfI/AAAAAAAAAE0/eJg_9E_gx_U/s400/%25280%2529%25E3%2581%25AE%25E3%2581%25A8%25E3%2581%258D%25E3%2581%25AE%25E7%25AF%2580%25E7%2582%25B9%25E3%2581%25A8%25E8%25A6%2581%25E7%25B4%25A0%25E3%2581%25AE%25E7%2595%25AA%25E5%258F%25B7.JPG)](http://1.bp.blogspot.com/-p1C9a2Do93U/VcNqS-T3MfI/AAAAAAAAAE0/eJg_9E_gx_U/s1600/%25280%2529%25E3%2581%25AE%25E3%2581%25A8%25E3%2581%258D%25E3%2581%25AE%25E7%25AF%2580%25E7%2582%25B9%25E3%2581%25A8%25E8%25A6%2581%25E7%25B4%25A0%25E3%2581%25AE%25E7%2595%25AA%25E5%258F%25B7.JPG)</div><div dir="ltr">  
</div><div dir="ltr">　次にGraft Treeコンポーネントを使用することでデータツリーを意図的に枝別れさせます。パネルから1本は{ 0;0 }に、もう一本は{ 0;1 }に入っていることが分かります。このとき、タグを表示させると数字がかぶっており、かつ、要素のタグは2本とも「0」 となっています。これは、i端が節点0、j端が節点1である要素0というモデルが、2つ存在している、というモデリングなっています。</div><div dir="ltr">  
</div><div class="separator" style="clear: both; text-align: center;">[![](http://2.bp.blogspot.com/-PqBzkXZ2CWM/VcNq6W5b72I/AAAAAAAAAE8/T6fRANekw88/s400/%25E3%2582%25B0%25E3%2583%25A9%25E3%2583%2595%25E3%2583%2588%25E3%2581%2595%25E3%2581%259B%25E3%2581%259F%25E3%2581%25A8%25E3%2581%258D%25E3%2581%25AE%25E7%25AF%2580%25E7%2582%25B9%25E3%2581%25A8%25E8%25A6%2581%25E7%25B4%25A0%25E3%2581%25AE%25E7%2595%25AA%25E5%258F%25B7.JPG)](http://2.bp.blogspot.com/-PqBzkXZ2CWM/VcNq6W5b72I/AAAAAAAAAE8/T6fRANekw88/s1600/%25E3%2582%25B0%25E3%2583%25A9%25E3%2583%2595%25E3%2583%2588%25E3%2581%2595%25E3%2581%259B%25E3%2581%259F%25E3%2581%25A8%25E3%2581%258D%25E3%2581%25AE%25E7%25AF%2580%25E7%2582%25B9%25E3%2581%25A8%25E8%25A6%2581%25E7%25B4%25A0%25E3%2581%25AE%25E7%2595%25AA%25E5%258F%25B7.JPG)</div><div dir="ltr">  
</div><div dir="ltr">なので、たとえば、節点０に境界条件を設定すると、2点に境界条件が設定されてしまいます。つまり、Karambaにおいて、データがGraftしてしまうと、別れた分だけそれぞれ独立したモデルが作成されてしまうことになります。ですので、Karambaでのモデル作成においても、常にデータツリーを意識していくことが、無用な手戻りを避けることにつながります。</div><div dir="ltr">  
</div><div class="separator" style="clear: both; text-align: center;">[![](http://3.bp.blogspot.com/-apGvvU2tFeU/VcNsizCx02I/AAAAAAAAAFI/29riif7Rwtw/s400/%25E6%2584%258F%25E5%259B%25B3%25E3%2581%2597%25E3%2581%25AA%25E3%2581%2584%25E4%25BA%258C%25E3%2581%25A4%25E3%2581%25AE%25E5%25A2%2583%25E7%2595%258C%25E6%259D%25A1%25E4%25BB%25B6.JPG)](http://3.bp.blogspot.com/-apGvvU2tFeU/VcNsizCx02I/AAAAAAAAAFI/29riif7Rwtw/s1600/%25E6%2584%258F%25E5%259B%25B3%25E3%2581%2597%25E3%2581%25AA%25E3%2581%2584%25E4%25BA%258C%25E3%2581%25A4%25E3%2581%25AE%25E5%25A2%2583%25E7%2595%258C%25E6%259D%25A1%25E4%25BB%25B6.JPG)</div><div class="separator" style="clear: both; text-align: center;">  
</div><div class="separator" style="clear: both; text-align: left;">  
</div><div dir="ltr">　上の説明では、単純な2本のカーブなので、意識しなくとも、一体のモデルとなりましたが、GHを使った形態創生を行ったときは、データツリーが複雑になりがちです。以下では、ボロノイ分割からなる骨組みを例に、データツリーがどうなっているか見てモデル化していきます。</div><div dir="ltr">　最適化へのパラメータとして使用できるようここでは、ランダムに10個の点を打ち、その点からボロノイをGHのVoronoiコンポーネントを使用して作成します。</div><div dir="ltr">  
</div><div class="separator" style="clear: both; text-align: center;">[![](http://3.bp.blogspot.com/-7JVLJjR9H1s/VcNxy2plHxI/AAAAAAAAAFY/-2yRlOXf0Bg/s400/%25E3%2583%259C%25E3%2583%25AD%25E3%2583%258E%25E3%2582%25A4%25E4%25BD%259C%25E6%2588%2590.JPG)](http://3.bp.blogspot.com/-7JVLJjR9H1s/VcNxy2plHxI/AAAAAAAAAFY/-2yRlOXf0Bg/s1600/%25E3%2583%259C%25E3%2583%25AD%25E3%2583%258E%25E3%2582%25A4%25E4%25BD%259C%25E6%2588%2590.JPG)</div><div dir="ltr">  
</div><div dir="ltr">　作成されたボロノイの中身を確認すると、各領域ごとの閉じた多角形状のポリラインカーブの集まりとして認識されています。これをこのまま、Line to Beamコンポーネントを使用してKarambaに取り込もうとしても、ポリラインでは取り込めないので、何のモデルも作成されません。</div><div dir="ltr">　そこで、Deconstruct Brepコンポーネントを使用して、このボロノイのエッジ部分のみを取り出すことで、単独のカーブに分解します。Karambaに取り込んでノードタグを表示させたのが、下図になります。節点が重複してしまっていることが分かります。パネルで、分解して作成したエッジの中身も合わせて表示していますが、みてわかるように、もともと一つのポリラインカーブだったものごとに分かれてしまっています。そのため、2本のカーブの事例で説明したものと同じように、ただ単に複数のモデルが作成されてしまったのです。</div><div dir="ltr">  
</div><div class="separator" style="clear: both; text-align: center;">[![](http://3.bp.blogspot.com/-I3AK4QDrOdM/VcN0NMQzfWI/AAAAAAAAAFk/Fkf79OOmP84/s400/DeBrep%25E5%25BE%258C.JPG)](http://3.bp.blogspot.com/-I3AK4QDrOdM/VcN0NMQzfWI/AAAAAAAAAFk/Fkf79OOmP84/s1600/DeBrep%25E5%25BE%258C.JPG)</div><div dir="ltr">  
</div><div dir="ltr">　この問題を解決するためには、データツリーをルート部分だけにすればよいので、Flatten Treeコンポーネントを使用して、すべて｛ 0 ｝のところにカーブが所属するようにしてあげれば、重複なく、モデル化することができます。意図通りの一体化したモデルの作成ができたので、後は境界条件等を指定すれば、解析に持っていくことができます。</div><div dir="ltr">  
</div><div class="separator" style="clear: both; text-align: center;">[![](http://2.bp.blogspot.com/-aQEns6UMCms/VcN241zn4BI/AAAAAAAAAFw/7jJVwUjFO8o/s400/%25E3%2583%25A2%25E3%2583%2587%25E3%2583%25AB%25E5%258C%2596%25E6%2588%2590%25E5%258A%259F.JPG)](http://2.bp.blogspot.com/-aQEns6UMCms/VcN241zn4BI/AAAAAAAAAFw/7jJVwUjFO8o/s1600/%25E3%2583%25A2%25E3%2583%2587%25E3%2583%25AB%25E5%258C%2596%25E6%2588%2590%25E5%258A%259F.JPG)</div><div dir="ltr">  
</div><div dir="ltr">　</div>