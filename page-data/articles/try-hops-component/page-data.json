{"componentChunkName":"component---src-templates-article-post-js","path":"/articles/try-hops-component","result":{"data":{"markdownRemark":{"html":"<h2>はじめに</h2>\n<h3>Hops とは</h3>\n<p>Hops は Rhino7 から使用できるようになった新しい Grasshopper コンポーネントです。</p>\n<h3>必要な環境</h3>\n<ol>\n<li>Windows（内部で RhinoInside が動く部分があるため）</li>\n<li>Rhino 7.4 以上</li>\n<li>CPython 3.8 以上</li>\n<li>Visual Studio Code(任意の Python を書きやすいテキストエディタ)</li>\n</ol>\n<h3>参考資料</h3>\n<p>前半の Hops を Grasshopper の Cluster のように使用をする方法は以下の公式の資料をもとにしています。</p>\n<p><a href=\"https://developer.rhino3d.com/guides/grasshopper/hops-component/\">Hops Component</a></p>\n<p>後半の Hops を使った CPython コンポーネント作成は以下の RhinocerosForums の以下のディスカッションや RhinoCompute のリポジトリをもとにしています。</p>\n<ul>\n<li><a href=\"https://discourse.mcneel.com/t/create-cpython-components-using-hops-in-grasshopper/120517?u=hiron\">Create CPython components using Hops in Grasshopper</a></li>\n<li><a href=\"https://github.com/mcneel/compute.rhino3d/tree/master/src/ghhops-server-py\">compute.rhino3d/src/ghhops-server-py/</a></li>\n</ul>\n<h2>Hops コンポーネントのインストール方法</h2>\n<h2>Hops を使った CPython コンポーネントの作成</h2>\n<h3>GH Hops CPython とは</h3>\n<p>Grasshopper 内でも Python を使用できます。\nですが、IronPyrhon と呼ばれる .NET 環境向けの Python となっており、CPython に比べて自由度が低いです。</p>\n<p>Hops を使った CPython のコンポーネント作成では CPython3.8 以上が対応バージョンとなっており、最新の Python 環境、ライブラリを使用できるようになります。</p>\n<p>以下のような利点が挙げられています。</p>\n<ol>\n<li>Numpy や Scipy などの CPython のライブラリを呼ぶことができます</li>\n<li>TensorFlow のような最新の CPython を使用できます</li>\n<li>並列処理できて再利用可能に作ることができます</li>\n<li>ブレークポイントを含むデバッグモードを使用できます</li>\n<li>Visual Studio Code をフルでサポートしています</li>\n</ol>\n<h3>仕組みについて</h3>\n<p>内蔵されているデフォルトの HTTP サーバーを使って、Grasshopper のコンポーネントとして機能したり、Flask アプリのミドルウェアとして機能したりできます。\nHops の基本は HTTP で RhinoCompute とやり取りをして結果を返すものでした。\n前の章では、Grasshopper の .gh ファイルそのものを使って RhinoCompute を読んでいましたが、ここでは Python から RhinoCompute をよんでその結果を Grasshopper に返すものになっています。</p>\n<h3>環境構築</h3>\n<p>Python の venv を使用して Python の環境を構築します。\n環境を構築したいフォルダに移動して以下を実行し環境構築し、アクティブにします。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\">python <span class=\"token operator\">-</span>m venv venv\n<span class=\"token punctuation\">.</span>\\venv\\Script\\activate</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Python が複数インストールされている場合は、3.8 以上であること確認してください。以下でバージョンを確認できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\">python <span class=\"token operator\">-</span>V</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>デフォルトの Python が想定しているバージョンではなかった場合、例えば以下のようバージョンを指定して venv を作成するとその環境は対象のバージョンになります。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\">python3<span class=\"token punctuation\">.</span><span class=\"token number\">9</span> <span class=\"token operator\">-</span>m venv venv\n<span class=\"token comment\"># 以降は同じ</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>必要なライブラリをインストールします。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\">pip install ghhops<span class=\"token operator\">-</span>server flask</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h3>コードをかく</h3>\n<p>実装例は以下です。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> flask <span class=\"token keyword\">import</span> Flask\n<span class=\"token keyword\">import</span> ghhops_server <span class=\"token keyword\">as</span> hs\n<span class=\"token keyword\">import</span> rhino3dm\n\n<span class=\"token comment\"># register hops app as middleware</span>\napp <span class=\"token operator\">=</span> Flask<span class=\"token punctuation\">(</span>__name__<span class=\"token punctuation\">)</span>\nhops <span class=\"token operator\">=</span> hs<span class=\"token punctuation\">.</span>Hops<span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@hops<span class=\"token punctuation\">.</span>component</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"/pointat\"</span><span class=\"token punctuation\">,</span>\n    name<span class=\"token operator\">=</span><span class=\"token string\">\"PointAt\"</span><span class=\"token punctuation\">,</span>\n    description<span class=\"token operator\">=</span><span class=\"token string\">\"Get point along curve\"</span><span class=\"token punctuation\">,</span>\n    inputs<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>\n        hs<span class=\"token punctuation\">.</span>HopsCurve<span class=\"token punctuation\">(</span><span class=\"token string\">\"Curve\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"C\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Curve to evaluate\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        hs<span class=\"token punctuation\">.</span>HopsNumber<span class=\"token punctuation\">(</span><span class=\"token string\">\"t\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"t\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Parameter on Curve to evaluate\"</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token number\">2.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    outputs<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>\n        hs<span class=\"token punctuation\">.</span>HopsPoint<span class=\"token punctuation\">(</span><span class=\"token string\">\"P\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"P\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Point on curve at t\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">pointat</span><span class=\"token punctuation\">(</span>curve<span class=\"token punctuation\">:</span>rhino3dm<span class=\"token punctuation\">.</span>Curve<span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">:</span><span class=\"token builtin\">float</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> curve<span class=\"token punctuation\">.</span>PointAt<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n    app<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span>debug<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>@hops.component の箇所でコンポーネントの見た目を設定しています。\nC# コンポーネントでいうところの GH_Component を継承したクラスのコンストラクタや RegisterInput/OutputParams に該当する部分です。</p>\n<p>inputs や outputs の部分であるように入出力には型指定が必要なので、適切な型を選択するようにしてください。以下の型があります。\n<a href=\"https://github.com/mcneel/compute.rhino3d/blob/master/src/ghhops-server-py/ghhops_server/params.py#L9\">実装</a> をみるとそれ以外の型はコメントアウトされているので、そのうち実装されるかもしれません。</p>\n<ul>\n<li>HopsBoolean</li>\n<li>HopsBrep</li>\n<li>HopsCurve</li>\n<li>HopsInteger</li>\n<li>HopsLine</li>\n<li>HopsMesh</li>\n<li>HopsNumber</li>\n<li>HopsPoint</li>\n<li>HopsString</li>\n<li>HopsSubD</li>\n<li>HopsSurface</li>\n<li>HopsVector</li>\n</ul>\n<p>icon も指定できます。</p>","excerpt":"はじめに Hops とは Hops は Rhino7 から使用できるようになった新しい Grasshopper コンポーネントです。 必要な環境 Windows（内部で RhinoInside が動く部分があるため） Rhino 7.4 以上 CPython 3.8 以上 Visual Studio Code…","frontmatter":{"date":"03 April, 2021","path":"/articles/try-hops-component","title":"Grasshopper の Hops のはじめ方","article_tags":["Grasshopper","Python"]},"fields":{"readingTime":{"text":"2 min read"},"slug":"/Try-Hops-component/","collection":"article"}},"site":{"siteMetadata":{"title":"構造とデジタル_最新版_Final(1)"}}},"pageContext":{}},"staticQueryHashes":["32046230","3649515864"]}